import os
from dotenv import load_dotenv

print("--- 🔑 APIキー デバッグスクリプト開始 ---")

# 1. .env ファイルを読み込む
print("\n🔄 .env ファイルの読み込みを試みます...")
# load_dotenv() は .env ファイルを見つけて環境変数を設定します。
# 戻り値が True ならファイルが見つかって読み込めたことを意味します。
found_dotenv = load_dotenv()

if found_dotenv:
    print("✅ .env ファイルが見つかり、読み込みました。")
else:
    print("⚠️ .env ファイルが見つかりませんでした。")
    print("   -> ファイル名が '**.env**' になっているか確認してください。")


# 2. 環境変数からAPIキーを取得する
print("\n🔄 環境変数 'GOOGLE_API_KEY' の取得を試みます...")
api_key = os.getenv("GOOGLE_API_KEY")


# 3. 取得したキーを検証・表示する (これが最も重要です)
if not api_key:
    print("\n❌ 失敗: プログラムはAPIキーを読み込めませんでした。")
    print("   -> .env ファイル内に 'GOOGLE_API_KEY=...' の記述があるか確認してください。")
else:
    print("\n✅ 成功: プログラムはAPIキーを読み込みました。")
    print("   -> 以下に、読み込まれたキーの一部を表示します。")
    print("--------------------------------------------------")
    # キー全体を表示すると危険なため、最初と最後の5文字だけ表示します
    print(f"   読み込まれたキーの最初の5文字:  {api_key[:5]}")
    print(f"   読み込まれたキーの最後の5文字:  {api_key[-5:]}")
    print("--------------------------------------------------")
    print("\n💡 この文字列が、Google Cloudコンソールでコピーしたものと一致しているか確認してください。")
    print("   もし違う場合、.env ファイルの保存ができていない可能性があります。")

print("\n--- 🔑 デバッグスクリプト終了 ---")